


<!DOCTYPE html>
<html id="htmlId">
<head>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8"> 
  <title>Coverage Report > TeacherExamManagementController</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">comp3111.examsystem.controller</a>
</div>

<h1>Coverage Summary for Class: TeacherExamManagementController (comp3111.examsystem.controller)</h1>

<table class="coverageStats">
<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Class, %
</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Branch, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">TeacherExamManagementController</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (1/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    84.4%
  </span>
  <span class="absValue">
    (27/32)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    68.5%
  </span>
  <span class="absValue">
    (226/330)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    81.1%
  </span>
  <span class="absValue">
    (244/301)
  </span>
</td>
</tr>

</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;package comp3111.examsystem.controller;
&nbsp;
&nbsp;import java.net.URL;
&nbsp;import java.util.ArrayList;
&nbsp;import java.util.List;
&nbsp;import java.util.ResourceBundle;
&nbsp;import java.util.stream.Collectors;
&nbsp;
&nbsp;import comp3111.examsystem.model.Course;
&nbsp;import comp3111.examsystem.model.Question;
&nbsp;import comp3111.examsystem.model.Quiz;
&nbsp;import comp3111.examsystem.service.Database;
&nbsp;import comp3111.examsystem.service.MsgSender;
&nbsp;import javafx.beans.property.SimpleStringProperty;
&nbsp;import javafx.collections.FXCollections;
&nbsp;import javafx.collections.ObservableList;
&nbsp;import javafx.event.ActionEvent;
&nbsp;import javafx.fxml.FXML;
&nbsp;import javafx.scene.control.*;
&nbsp;import javafx.scene.layout.FlowPane;
&nbsp;import javafx.scene.layout.HBox;
&nbsp;import javafx.scene.layout.VBox;
&nbsp;import javafx.application.Platform;
&nbsp;
&nbsp;/**
&nbsp; * Controller for the Teacher&#39;s Exam Management page
&nbsp; */
<b class="fc">&nbsp;public class TeacherExamManagementController {</b>
&nbsp;    public Database&lt;Question&gt; questionDatabase;
&nbsp;    public List&lt;Question&gt; allQuestions;
&nbsp;    public ObservableList&lt;Question&gt; questionList;
&nbsp;    public Database&lt;Quiz&gt; quizDatabase;
&nbsp;    public List&lt;Quiz&gt; allQuizzes;
&nbsp;    public ObservableList&lt;Quiz&gt; quizList;
&nbsp;    public Database&lt;Course&gt; courseDatabase;
&nbsp;    public List&lt;Course&gt; allCourses;
&nbsp;    public ObservableList&lt;Course&gt; courseList;
&nbsp;    public ObservableList&lt;Question&gt; examQuestionList;
&nbsp;
&nbsp;    @FXML
&nbsp;    public ResourceBundle resources;
&nbsp;    @FXML
&nbsp;    public URL location;
&nbsp;    @FXML
&nbsp;    public Button addButton;
&nbsp;    @FXML
&nbsp;    public Button addQuestionButton;
&nbsp;    @FXML
&nbsp;    public ChoiceBox&lt;String&gt; courseIDFilterChoiceBox;
&nbsp;    @FXML
&nbsp;    public ChoiceBox&lt;String&gt; courseIDInput;
&nbsp;    @FXML
&nbsp;    public Button deleteButton;
&nbsp;    @FXML
&nbsp;    public TableColumn&lt;Quiz, String&gt; examCourseIDColumn;
&nbsp;    @FXML
&nbsp;    public Button examFilterResetButton;
&nbsp;    @FXML
&nbsp;    public HBox examManagementButtons;
&nbsp;    @FXML
&nbsp;    public HBox examManagementPanel;
&nbsp;    @FXML
&nbsp;    public TableColumn&lt;Quiz, String&gt; examNameColumn;
&nbsp;    @FXML
&nbsp;    public TextField examNameFilterTextField;
&nbsp;    @FXML
&nbsp;    public TextField examNameInput;
&nbsp;    @FXML
&nbsp;    public TableColumn&lt;Quiz, String&gt; examPublishStatusColumn;
&nbsp;    @FXML
&nbsp;    public TableColumn&lt;Question, String&gt; examQuestionColumn;
&nbsp;    @FXML
&nbsp;    public TableColumn&lt;Question, String&gt; examQuestionScoreColumn;
&nbsp;    @FXML
&nbsp;    public TableColumn&lt;Question, String&gt; examQuestionTypeColumn;
&nbsp;    @FXML
&nbsp;    public TableColumn&lt;Quiz, String&gt; examTimeColumn;
&nbsp;    @FXML
&nbsp;    public TextField examTimeInput;
&nbsp;    @FXML
&nbsp;    public HBox filterPanel;
&nbsp;    @FXML
&nbsp;    public VBox optionCInput;
&nbsp;    @FXML
&nbsp;    public VBox optionDInput;
&nbsp;    @FXML
&nbsp;    public ChoiceBox&lt;String&gt; publishInput;
&nbsp;    @FXML
&nbsp;    public ChoiceBox&lt;String&gt; publishStatusFilterChoiceBox;
&nbsp;    @FXML
&nbsp;    public TableColumn&lt;Question, String&gt; questionColumn;
&nbsp;    @FXML
&nbsp;    public Button questionFilterButton;
&nbsp;    @FXML
&nbsp;    public Button questionFilterResetButton;
&nbsp;    @FXML
&nbsp;    public TextField questionFilterTextField;
&nbsp;    @FXML
&nbsp;    public VBox questionInputFields;
&nbsp;    @FXML
&nbsp;    public TableColumn&lt;Question, String&gt; questionScoreColumn;
&nbsp;    @FXML
&nbsp;    public TableView&lt;Quiz&gt; examTable;
&nbsp;    @FXML
&nbsp;    public TableView&lt;Question&gt; examQuestionsTable;
&nbsp;    @FXML
&nbsp;    public TableView&lt;Question&gt; allQuestionsTable;
&nbsp;    @FXML
&nbsp;    public TableColumn&lt;Question, String&gt; questionTypeColumn;
&nbsp;    @FXML
&nbsp;    public Button refreshButton;
&nbsp;    @FXML
&nbsp;    public Button removeQuestionButton;
&nbsp;    @FXML
&nbsp;    public Button examFilterButton;
&nbsp;    @FXML
&nbsp;    public FlowPane rootPane;
&nbsp;    @FXML
&nbsp;    public TextField scoreFilterTextField;
&nbsp;    @FXML
&nbsp;    public ChoiceBox&lt;String&gt; typeFilterChoiceBox;
&nbsp;    @FXML
&nbsp;    public Button updateButton;
&nbsp;    @FXML
&nbsp;    public HBox examFilterPanel;
&nbsp;    @FXML
&nbsp;    public HBox questionFilterPanel;
&nbsp;    @FXML
&nbsp;    public VBox examManagementField;
&nbsp;    @FXML
&nbsp;    public HBox questionTablesField;
&nbsp;
&nbsp;    /**
&nbsp;     * Initialize the controller
&nbsp;     */
&nbsp;    @FXML
&nbsp;    public void initialize() {
<b class="fc">&nbsp;        this.questionDatabase = new Database&lt;&gt;(Question.class);</b>
<b class="fc">&nbsp;        allQuestions = questionDatabase.getAll();</b>
<b class="fc">&nbsp;        loadAllQuestions();</b>
&nbsp;
<b class="fc">&nbsp;        this.quizDatabase = new Database&lt;&gt;(Quiz.class);</b>
<b class="fc">&nbsp;        allQuizzes = quizDatabase.getAll();</b>
<b class="fc">&nbsp;        loadQuizzes();</b>
&nbsp;
<b class="fc">&nbsp;        this.courseDatabase = new Database&lt;&gt;(Course.class);</b>
<b class="fc">&nbsp;        allCourses = courseDatabase.getAll();</b>
&nbsp;
<b class="fc">&nbsp;        examQuestionList = FXCollections.observableArrayList();</b>
&nbsp;
&nbsp;        // Set up the exam filter options
<b class="fc">&nbsp;        for (Quiz quiz : allQuizzes) {</b>
<b class="fc">&nbsp;            courseIDFilterChoiceBox.getItems().add(quiz.getCourseID());</b>
&nbsp;        }
<b class="fc">&nbsp;        courseIDFilterChoiceBox.getItems().add(&quot;&quot;);</b>
<b class="fc">&nbsp;        courseIDFilterChoiceBox.setValue(&quot;&quot;);</b>
<b class="fc">&nbsp;        publishStatusFilterChoiceBox.getItems().addAll(&quot;Yes&quot;, &quot;No&quot;, &quot;&quot;);</b>
<b class="fc">&nbsp;        publishStatusFilterChoiceBox.setValue(&quot;&quot;);</b>
&nbsp;
&nbsp;        // Set up the question filter options
<b class="fc">&nbsp;        typeFilterChoiceBox.getItems().addAll(&quot;Single&quot;, &quot;Multiple&quot;, &quot;&quot;);</b>
<b class="fc">&nbsp;        typeFilterChoiceBox.setValue(&quot;&quot;);</b>
&nbsp;
&nbsp;        // Set up exam input filter options
<b class="fc">&nbsp;        for (Course course : allCourses) {</b>
<b class="fc">&nbsp;            courseIDInput.getItems().add(course.getCourseID());</b>
&nbsp;        }
<b class="fc">&nbsp;        publishInput.getItems().addAll(&quot;Yes&quot;, &quot;No&quot;);</b>
&nbsp;
&nbsp;        // Handle resize of width of different components when the window is resized
<b class="fc">&nbsp;        rootPane.widthProperty().addListener((obs, oldVal, newVal) -&gt; {</b>
&nbsp;            // Handle resize of filter components
<b class="nc">&nbsp;            filterPanel.setPrefWidth(newVal.doubleValue());</b>
<b class="nc">&nbsp;            examFilterPanel.setPrefHeight(newVal.doubleValue() * 0.5);</b>
<b class="nc">&nbsp;            questionFilterPanel.setPrefHeight(newVal.doubleValue() * 0.5);</b>
&nbsp;
&nbsp;            // Handle resize of exam management components
<b class="nc">&nbsp;            examManagementPanel.setPrefWidth(newVal.doubleValue());</b>
&nbsp;
&nbsp;            // Handle resize of exam table
<b class="nc">&nbsp;            double examTableWidth = newVal.doubleValue() * 0.34;</b>
<b class="nc">&nbsp;            examTable.setPrefWidth(examTableWidth);</b>
<b class="nc">&nbsp;            examNameColumn.setPrefWidth(examTableWidth * 0.3);</b>
<b class="nc">&nbsp;            examCourseIDColumn.setPrefWidth(examTableWidth * 0.3);</b>
<b class="nc">&nbsp;            examTimeColumn.setPrefWidth(examTableWidth * 0.2);</b>
<b class="nc">&nbsp;            examPublishStatusColumn.setPrefWidth(examTableWidth * 0.193);</b>
&nbsp;
&nbsp;            // Handle resize of exam questions table and all questions table
<b class="nc">&nbsp;            double examManagementFieldWidth = newVal.doubleValue() * 0.66;</b>
<b class="nc">&nbsp;            examManagementField.setPrefWidth(examManagementFieldWidth);</b>
<b class="nc">&nbsp;            double examQuestionsTableWidth = examManagementFieldWidth * 0.5;</b>
<b class="nc">&nbsp;            examQuestionsTable.setPrefWidth(examQuestionsTableWidth);</b>
<b class="nc">&nbsp;            examQuestionColumn.setPrefWidth(examQuestionsTableWidth * 0.6);</b>
<b class="nc">&nbsp;            examQuestionTypeColumn.setPrefWidth(examQuestionsTableWidth * 0.2);</b>
<b class="nc">&nbsp;            examQuestionScoreColumn.setPrefWidth(examQuestionsTableWidth * 0.193);</b>
<b class="nc">&nbsp;            double allQuestionsTableWidth = examManagementFieldWidth * 0.5;</b>
<b class="nc">&nbsp;            allQuestionsTable.setPrefWidth(allQuestionsTableWidth);</b>
<b class="nc">&nbsp;            questionColumn.setPrefWidth(allQuestionsTableWidth * 0.6);</b>
<b class="nc">&nbsp;            questionTypeColumn.setPrefWidth(allQuestionsTableWidth * 0.2);</b>
<b class="nc">&nbsp;            questionScoreColumn.setPrefWidth(allQuestionsTableWidth * 0.193);</b>
&nbsp;
&nbsp;            // Handle resize of exam management buttons
<b class="nc">&nbsp;            examManagementButtons.setPrefWidth(newVal.doubleValue());</b>
&nbsp;        });
&nbsp;
&nbsp;        // Handle resize of height of different components when the window is resized
<b class="fc">&nbsp;        rootPane.heightProperty().addListener((obs, oldVal, newVal) -&gt; {</b>
&nbsp;            // Handle resize of filter components
<b class="nc">&nbsp;            filterPanel.setPrefHeight(newVal.doubleValue() * 0.10);</b>
&nbsp;
&nbsp;            // Handle resize of exam management components
<b class="nc">&nbsp;            double examManagementPanelHeight = newVal.doubleValue() * 0.75;</b>
<b class="nc">&nbsp;            examManagementPanel.setPrefHeight(examManagementPanelHeight);</b>
<b class="nc">&nbsp;            examTable.setPrefHeight(examManagementPanelHeight);</b>
<b class="nc">&nbsp;            examManagementField.setPrefHeight(examManagementPanelHeight);</b>
<b class="nc">&nbsp;            double questionTablesFieldHeight = examManagementPanelHeight * 0.70;</b>
<b class="nc">&nbsp;            questionTablesField.setPrefHeight(questionTablesFieldHeight);</b>
<b class="nc">&nbsp;            examQuestionsTable.setPrefHeight(questionTablesFieldHeight);</b>
<b class="nc">&nbsp;            allQuestionsTable.setPrefHeight(questionTablesFieldHeight);</b>
&nbsp;
&nbsp;            // Handle resize of question management buttons
<b class="nc">&nbsp;            examManagementButtons.setPrefHeight(newVal.doubleValue() * 0.10);</b>
&nbsp;        });
&nbsp;
&nbsp;
&nbsp;        // Set up columns to extract data from each Quiz object for examTable
<b class="fc">&nbsp;        examNameColumn.setCellValueFactory(cellData -&gt; new SimpleStringProperty(cellData.getValue().getQuizName()));</b>
<b class="fc">&nbsp;        examCourseIDColumn.setCellValueFactory(cellData -&gt; new SimpleStringProperty(cellData.getValue().getCourseID()));</b>
<b class="fc">&nbsp;        examTimeColumn.setCellValueFactory(cellData -&gt; new SimpleStringProperty(cellData.getValue().getQuizTime()));</b>
<b class="fc">&nbsp;        examPublishStatusColumn.setCellValueFactory(cellData -&gt; new SimpleStringProperty(cellData.getValue().getPublishStatus()));</b>
&nbsp;
&nbsp;        // Set up columns to extract data from each Question object for examQuestionsTable
<b class="fc">&nbsp;        examQuestionColumn.setCellValueFactory(cellData -&gt; new SimpleStringProperty(cellData.getValue().getQuestionDescription()));</b>
<b class="fc">&nbsp;        examQuestionTypeColumn.setCellValueFactory(cellData -&gt; new SimpleStringProperty(cellData.getValue().getQuestionType()));</b>
<b class="fc">&nbsp;        examQuestionScoreColumn.setCellValueFactory(cellData -&gt; new SimpleStringProperty(cellData.getValue().getQuestionScore()));</b>
&nbsp;
&nbsp;        // Set up columns to extract data from each Question object for allQuestionsTable
<b class="fc">&nbsp;        questionColumn.setCellValueFactory(cellData -&gt; new SimpleStringProperty(cellData.getValue().getQuestionDescription()));</b>
<b class="fc">&nbsp;        questionTypeColumn.setCellValueFactory(cellData -&gt; new SimpleStringProperty(cellData.getValue().getQuestionType()));</b>
<b class="fc">&nbsp;        questionScoreColumn.setCellValueFactory(cellData -&gt; new SimpleStringProperty(cellData.getValue().getQuestionScore()));</b>
&nbsp;
&nbsp;        // Set up the listener for the table selection
<b class="fc">&nbsp;        examTable.getSelectionModel().selectedItemProperty().addListener((obs, oldSelection, newSelection) -&gt; {</b>
<b class="nc">&nbsp;            if (newSelection != null) {</b>
<b class="nc">&nbsp;                loadExamQuestions(newSelection.getId());</b>
&nbsp;
<b class="nc">&nbsp;                examNameInput.setText(newSelection.getQuizName());</b>
<b class="nc">&nbsp;                examTimeInput.setText(newSelection.getQuizTime());</b>
<b class="nc">&nbsp;                courseIDInput.setValue(newSelection.getCourseID());</b>
<b class="nc">&nbsp;                publishInput.setValue(newSelection.getPublishStatus());</b>
&nbsp;            }
&nbsp;        });
&nbsp;
&nbsp;        // Clear the selection when clicking on the table itself with no quiz selected
<b class="fc">&nbsp;        examTable.setRowFactory(tv -&gt; {</b>
<b class="nc">&nbsp;            TableRow&lt;Quiz&gt; row = new TableRow&lt;&gt;();</b>
<b class="nc">&nbsp;            row.setOnMouseClicked(event -&gt; {</b>
<b class="nc">&nbsp;                if (row.isEmpty()) {</b>
<b class="nc">&nbsp;                    examTable.getSelectionModel().clearSelection();</b>
<b class="nc">&nbsp;                    examQuestionList.clear();</b>
<b class="nc">&nbsp;                    loadExamQuestions();</b>
<b class="nc">&nbsp;                    clearFields();</b>
&nbsp;                }
&nbsp;            });
<b class="nc">&nbsp;            return row;</b>
&nbsp;        });
&nbsp;
<b class="pc">&nbsp;    }</b>
&nbsp;
&nbsp;    /**
&nbsp;     * Handle the add exam button action
&nbsp;     * @param event the ActionEvent
&nbsp;     */
&nbsp;    @FXML
&nbsp;    public void addExam(ActionEvent event) {
<b class="pc">&nbsp;        String examName = examNameInput.getText();</b>
<b class="fc">&nbsp;        String examTime = examTimeInput.getText();</b>
<b class="fc">&nbsp;        String courseID = courseIDInput.getValue();</b>
<b class="fc">&nbsp;        String publishStatus = publishInput.getValue();</b>
<b class="fc">&nbsp;        String questionIDs = getQuestionIDs(examQuestionList);</b>
&nbsp;
<b class="fc">&nbsp;        if (!validInputs(examName, examTime, courseID, publishStatus, questionIDs)) {</b>
&nbsp;            return;
&nbsp;        }
&nbsp;
&nbsp;        // check if the quiz already exists
<b class="fc">&nbsp;        for (Quiz quiz : allQuizzes) {</b>
<b class="pc">&nbsp;            if (quiz.getQuizName().equals(examName) &amp;&amp; quiz.getCourseID().equals(courseID)) {</b>
<b class="fc">&nbsp;                MsgSender.showMsg(&quot;The exam already exists.&quot;);</b>
&nbsp;                return;
&nbsp;            }
&nbsp;        }
&nbsp;
&nbsp;        try {
<b class="fc">&nbsp;            int quizId = allQuizzes.size() + 1;</b>
<b class="fc">&nbsp;            Quiz newQuiz = new Quiz(examName, examTime, courseID, publishStatus, quizId, questionIDs);</b>
&nbsp;
&nbsp;            // Store the quiz information in the database
<b class="fc">&nbsp;            quizDatabase.add(newQuiz);</b>
&nbsp;
<b class="fc">&nbsp;            MsgSender.showMsg(&quot;Exam added successfully.&quot;);</b>
<b class="fc">&nbsp;            loadQuizzes();</b>
<b class="fc">&nbsp;            examQuestionList.clear();</b>
<b class="fc">&nbsp;            loadExamQuestions();</b>
<b class="fc">&nbsp;            clearFields();</b>
<b class="fc">&nbsp;        } catch (Exception e) {</b>
<b class="fc">&nbsp;            MsgSender.showMsg(&quot;An error occurred while adding the exam.&quot;);</b>
<b class="fc">&nbsp;            e.printStackTrace();</b>
&nbsp;        }
<b class="fc">&nbsp;    }</b>
&nbsp;
&nbsp;    /**
&nbsp;     * Get the question IDs from the exam question list
&nbsp;     * @param examQuestionList list of questions in the exam
&nbsp;     * @return a string of question IDs concatenated by &quot;|&quot;
&nbsp;     */
&nbsp;    public String getQuestionIDs(ObservableList&lt;Question&gt; examQuestionList) {
<b class="pc">&nbsp;        return examQuestionList.stream()</b>
<b class="fc">&nbsp;                .map(question -&gt; String.valueOf(question.getId()))</b>
<b class="fc">&nbsp;                .collect(Collectors.joining(&quot;|&quot;));</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Check if the inputs for adding or updating an exam are valid
&nbsp;     * @param examName the name of the exam
&nbsp;     * @param examTime the time limit of the exam
&nbsp;     * @param courseID the course ID of the exam
&nbsp;     * @param publishStatus the publish status of the exam
&nbsp;     * @param questionIDs the question IDs of the exam
&nbsp;     * @return true if all inputs are valid, false otherwise
&nbsp;     */
&nbsp;    public boolean validInputs(String examName, String examTime, String courseID, String publishStatus, String questionIDs) {
&nbsp;        // check if all fields are filled
<b class="pc">&nbsp;        if (examName.isEmpty() || examTime.isEmpty() || courseID.isEmpty() || publishStatus.isEmpty()) {</b>
<b class="fc">&nbsp;            MsgSender.showMsg(&quot;All fields must be filled.&quot;);</b>
<b class="fc">&nbsp;            return false;</b>
&nbsp;        }
&nbsp;
&nbsp;        // check if there is at least one question in the exam
<b class="fc">&nbsp;        if (questionIDs.isEmpty()) {</b>
<b class="fc">&nbsp;            MsgSender.showMsg(&quot;At least one question must be added to the exam.&quot;);</b>
<b class="fc">&nbsp;            return false;</b>
&nbsp;        }
&nbsp;
&nbsp;        // check if examTime is a number
<b class="fc">&nbsp;        int examTimeInt = 0;</b>
&nbsp;        try {
<b class="fc">&nbsp;            examTimeInt = Integer.parseInt(examTime);</b>
<b class="fc">&nbsp;        } catch (NumberFormatException e) {</b>
<b class="fc">&nbsp;            MsgSender.showMsg(&quot;Exam time must be a number.&quot;);</b>
<b class="fc">&nbsp;            return false;</b>
&nbsp;        }
&nbsp;
&nbsp;        // check if examTime is a positive number
<b class="fc">&nbsp;        if (examTimeInt &lt;= 0) {</b>
<b class="fc">&nbsp;            MsgSender.showMsg(&quot;Exam time must be a positive number.&quot;);</b>
<b class="fc">&nbsp;            return false;</b>
&nbsp;        }
&nbsp;
<b class="pc">&nbsp;        return true;</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Handle the delete exam button action
&nbsp;     * @param event the ActionEvent
&nbsp;     */
&nbsp;    @FXML
&nbsp;    public void deleteExam(ActionEvent event) {
<b class="pc">&nbsp;        Quiz selectedQuiz = examTable.getSelectionModel().getSelectedItem();</b>
&nbsp;
<b class="pc">&nbsp;        if (selectedQuiz == null) {</b>
<b class="nc">&nbsp;            MsgSender.showMsg(&quot;Please select an exam to delete.&quot;);</b>
&nbsp;            return;
&nbsp;        }
&nbsp;
&nbsp;        try {
<b class="fc">&nbsp;            String idString = String.valueOf(selectedQuiz.getId());</b>
<b class="fc">&nbsp;            MsgSender.showConfirm(&quot;Exam Delete Confirmation&quot;, &quot;Are you sure that you want to delete the exam?&quot;, () -&gt; {</b>
<b class="fc">&nbsp;                quizDatabase.delByKey(idString);</b>
<b class="fc">&nbsp;                MsgSender.showMsg(&quot;Exam deleted successfully.&quot;);</b>
<b class="fc">&nbsp;                examTable.getSelectionModel().clearSelection();</b>
<b class="fc">&nbsp;                loadQuizzes();</b>
<b class="fc">&nbsp;                examQuestionList.clear();</b>
<b class="fc">&nbsp;                loadExamQuestions();</b>
<b class="fc">&nbsp;                clearFields();</b>
&nbsp;            });
<b class="fc">&nbsp;        } catch (Exception e) {</b>
<b class="fc">&nbsp;            MsgSender.showMsg(&quot;An error occurred while deleting the exam.&quot;);</b>
<b class="fc">&nbsp;            e.printStackTrace();</b>
&nbsp;        }
<b class="fc">&nbsp;    }</b>
&nbsp;
&nbsp;    /**
&nbsp;     * Handle the update exam button action
&nbsp;     * @param event the ActionEvent
&nbsp;     */
&nbsp;    @FXML
&nbsp;    public void updateExam(ActionEvent event) {
<b class="pc">&nbsp;        Quiz selectedQuiz = examTable.getSelectionModel().getSelectedItem();</b>
&nbsp;
<b class="fc">&nbsp;        if (selectedQuiz == null) {</b>
<b class="fc">&nbsp;            MsgSender.showMsg(&quot;Please select an exam to update.&quot;);</b>
&nbsp;            return;
&nbsp;        }
&nbsp;
<b class="fc">&nbsp;        String oldPublishStatus = selectedQuiz.getPublishStatus();</b>
&nbsp;
&nbsp;        // check if the exam is published
<b class="fc">&nbsp;        if (oldPublishStatus.equals(&quot;Yes&quot;) || oldPublishStatus.equals(&quot;yes&quot;)) {</b>
<b class="fc">&nbsp;            MsgSender.showMsg(&quot;Cannot update a published exam.&quot;);</b>
&nbsp;            return;
&nbsp;        }
&nbsp;
<b class="fc">&nbsp;        String examName = examNameInput.getText();</b>
<b class="fc">&nbsp;        String examTime = examTimeInput.getText();</b>
<b class="fc">&nbsp;        String courseID = courseIDInput.getValue();</b>
<b class="fc">&nbsp;        String publishStatus = publishInput.getValue();</b>
<b class="fc">&nbsp;        String questionIDs = getQuestionIDs(examQuestionList);</b>
&nbsp;
&nbsp;        // check valid inputs
<b class="fc">&nbsp;        if (!validInputs(examName, examTime, courseID, publishStatus, questionIDs)) {</b>
&nbsp;            return;
&nbsp;        }
&nbsp;
<b class="fc">&nbsp;        selectedQuiz.setQuizName(examName);</b>
<b class="fc">&nbsp;        selectedQuiz.setQuizTime(examTime);</b>
<b class="fc">&nbsp;        selectedQuiz.setCourseID(courseID);</b>
<b class="fc">&nbsp;        selectedQuiz.setPublishStatus(publishStatus);</b>
<b class="fc">&nbsp;        selectedQuiz.setQuestionIDs(questionIDs);</b>
&nbsp;
&nbsp;        try {
<b class="fc">&nbsp;            MsgSender.showConfirm(&quot;Exam Update Confirmation&quot;, &quot;Are you sure that you want to update the exam?&quot;, () -&gt; {</b>
<b class="fc">&nbsp;                quizDatabase.update(selectedQuiz);</b>
<b class="fc">&nbsp;                MsgSender.showMsg(&quot;Exam updated successfully.&quot;);</b>
<b class="fc">&nbsp;                examTable.getSelectionModel().clearSelection();</b>
<b class="fc">&nbsp;                loadQuizzes();</b>
<b class="fc">&nbsp;                examQuestionList.clear();</b>
<b class="fc">&nbsp;                loadExamQuestions();</b>
<b class="fc">&nbsp;                clearFields();</b>
&nbsp;            });
<b class="fc">&nbsp;        } catch (Exception e) {</b>
<b class="fc">&nbsp;            MsgSender.showMsg(&quot;An error occurred while updating the exam.&quot;);</b>
<b class="fc">&nbsp;            e.printStackTrace();</b>
&nbsp;        }
<b class="pc">&nbsp;    }</b>
&nbsp;
&nbsp;    /**
&nbsp;     * Get the list of questions from the database
&nbsp;     * @param questionIDs the string of question IDs concatenated by &quot;|&quot;
&nbsp;     * @return the list of questions
&nbsp;     */
&nbsp;    public List&lt;Question&gt; getExamQuestionList(String questionIDs) {
<b class="pc">&nbsp;        List&lt;String&gt; questionIDsList = List.of(questionIDs.split(&quot;\\|&quot;));</b>
<b class="fc">&nbsp;        List&lt;Question&gt; questions = new ArrayList&lt;&gt;();</b>
&nbsp;
&nbsp;        try {
<b class="fc">&nbsp;            questions = questionDatabase.queryByKeys(questionIDsList);</b>
<b class="fc">&nbsp;        } catch (Exception e) {</b>
<b class="fc">&nbsp;            MsgSender.showMsg(&quot;An error occurred while loading the exam questions.&quot;);</b>
<b class="fc">&nbsp;            e.printStackTrace();</b>
&nbsp;        }
<b class="fc">&nbsp;        return questions;</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Handle the add question button action
&nbsp;     * @param event the ActionEvent
&nbsp;     */
&nbsp;    @FXML
&nbsp;    public void addQuestionToExams(ActionEvent event) {
<b class="pc">&nbsp;        Question selectedQuestion = allQuestionsTable.getSelectionModel().getSelectedItem();</b>
&nbsp;
<b class="fc">&nbsp;        if (selectedQuestion == null) {</b>
<b class="fc">&nbsp;            MsgSender.showMsg(&quot;Please select a question to add to the exam.&quot;);</b>
&nbsp;            return;
&nbsp;        }
&nbsp;
&nbsp;        // check if the question is already added to the exam
<b class="pc">&nbsp;        for (Question question : examQuestionList) {</b>
<b class="fc">&nbsp;            if (question != null &amp;&amp; question.getId() == selectedQuestion.getId()) {</b>
<b class="fc">&nbsp;                MsgSender.showMsg(&quot;Question already added to the exam.&quot;);</b>
&nbsp;                return;
&nbsp;            }
&nbsp;        }
&nbsp;
&nbsp;        try {
<b class="fc">&nbsp;            examQuestionList.add(selectedQuestion);</b>
<b class="fc">&nbsp;        } catch (Exception e) {</b>
<b class="fc">&nbsp;            MsgSender.showMsg(&quot;An error occurred while adding the question to the exam.&quot;);</b>
<b class="fc">&nbsp;            e.printStackTrace();</b>
&nbsp;        }
<b class="fc">&nbsp;        MsgSender.showMsg(&quot;Question added to the exam successfully.&quot;);</b>
<b class="fc">&nbsp;        loadExamQuestions();</b>
<b class="fc">&nbsp;        allQuestionsTable.getSelectionModel().clearSelection();</b>
<b class="fc">&nbsp;    }</b>
&nbsp;
&nbsp;    /**
&nbsp;     * Handle the remove question button action
&nbsp;     * @param event the ActionEvent
&nbsp;     */
&nbsp;    @FXML
&nbsp;    public void removeQuestionFromExam(ActionEvent event) {
<b class="pc">&nbsp;        Question selectedQuestion = examQuestionsTable.getSelectionModel().getSelectedItem();</b>
&nbsp;
<b class="fc">&nbsp;        if (selectedQuestion == null) {</b>
<b class="fc">&nbsp;            MsgSender.showMsg(&quot;Please select a question to be removed from the exam.&quot;);</b>
&nbsp;            return;
&nbsp;        }
&nbsp;
&nbsp;        try {
<b class="fc">&nbsp;            examQuestionList.remove(selectedQuestion);</b>
<b class="fc">&nbsp;        } catch (Exception e) {</b>
<b class="fc">&nbsp;            MsgSender.showMsg(&quot;An error occurred while removing the question from the exam.&quot;);</b>
<b class="fc">&nbsp;            e.printStackTrace();</b>
&nbsp;        }
<b class="fc">&nbsp;        MsgSender.showMsg(&quot;Question removed from the exam successfully.&quot;);</b>
<b class="fc">&nbsp;        loadExamQuestions();</b>
<b class="fc">&nbsp;        examQuestionsTable.getSelectionModel().clearSelection();</b>
<b class="pc">&nbsp;    }</b>
&nbsp;
&nbsp;    /**
&nbsp;     * Handle the refresh button action
&nbsp;     * @param event the ActionEvent
&nbsp;     */
&nbsp;    @FXML
&nbsp;    public void refreshExamManagementPage(ActionEvent event) {
<b class="pc">&nbsp;        if (examTable.getSelectionModel().getSelectedItem() != null || !examTimeInput.getText().isEmpty() ||</b>
<b class="nc">&nbsp;                !examNameInput.getText().isEmpty() ||</b>
<b class="pc">&nbsp;                (courseIDInput.getValue() != null &amp;&amp; !courseIDInput.getValue().isEmpty()) ||</b>
<b class="nc">&nbsp;                (publishInput.getValue() != null &amp;&amp; !publishInput.getValue().isEmpty())) {</b>
&nbsp;            // ask for confirmation before refreshing
<b class="fc">&nbsp;            MsgSender.showConfirm(&quot;Refresh Confirmation&quot;, &quot;Refreshing will clear all fields and any unsaved changes will be lost. Are you sure you want to refresh?&quot;, () -&gt; {</b>
<b class="fc">&nbsp;                refreshExamManagementPageConfirmed(event);</b>
&nbsp;            });
&nbsp;        } else {
<b class="nc">&nbsp;            refreshExamManagementPageConfirmed(event);</b>
&nbsp;        }
<b class="fc">&nbsp;    }</b>
&nbsp;
&nbsp;    /**
&nbsp;     * Handle the refresh button action
&nbsp;     * @param event the ActionEvent
&nbsp;     */
&nbsp;    public void refreshExamManagementPageConfirmed(ActionEvent event) {
&nbsp;        // reset all filters
<b class="pc">&nbsp;        resetExamFilters(event);</b>
<b class="fc">&nbsp;        resetQuestionFilters(event);</b>
&nbsp;
&nbsp;        // clear all fields and deselect any selected rows
<b class="fc">&nbsp;        clearFields();</b>
<b class="fc">&nbsp;        examTable.getSelectionModel().clearSelection();</b>
<b class="fc">&nbsp;        examQuestionsTable.getSelectionModel().clearSelection();</b>
<b class="fc">&nbsp;        allQuestionsTable.getSelectionModel().clearSelection();</b>
&nbsp;
&nbsp;        // reload all quizzes and questions
<b class="fc">&nbsp;        loadQuizzes();</b>
<b class="fc">&nbsp;        loadAllQuestions();</b>
<b class="fc">&nbsp;    }</b>
&nbsp;
&nbsp;    /**
&nbsp;     * Handle the reset exam filter button action
&nbsp;     * @param event the ActionEvent
&nbsp;     */
&nbsp;    @FXML
&nbsp;    public void resetExamFilters(ActionEvent event) {
<b class="pc">&nbsp;        examNameFilterTextField.clear();</b>
<b class="fc">&nbsp;        courseIDFilterChoiceBox.setValue(&quot;&quot;);</b>
<b class="fc">&nbsp;        publishStatusFilterChoiceBox.setValue(&quot;&quot;);</b>
<b class="fc">&nbsp;        loadQuizzes();</b>
<b class="fc">&nbsp;    }</b>
&nbsp;
&nbsp;    /**
&nbsp;     * Handle the filter exam button action
&nbsp;     * @param event the ActionEvent
&nbsp;     */
&nbsp;    @FXML
&nbsp;    public void filterQuizzes(ActionEvent event) {
<b class="pc">&nbsp;        loadQuizzes();</b>
<b class="pc">&nbsp;    }</b>
&nbsp;
&nbsp;    /**
&nbsp;     * Handle the reset question filter button action
&nbsp;     * @param event the ActionEvent
&nbsp;     */
&nbsp;    @FXML
&nbsp;    public void resetQuestionFilters(ActionEvent event) {
<b class="pc">&nbsp;        questionFilterTextField.clear();</b>
<b class="fc">&nbsp;        typeFilterChoiceBox.setValue(&quot;&quot;);</b>
<b class="fc">&nbsp;        scoreFilterTextField.clear();</b>
<b class="fc">&nbsp;        loadAllQuestions();</b>
<b class="fc">&nbsp;    }</b>
&nbsp;
&nbsp;    /**
&nbsp;     * Handle the filter question button action
&nbsp;     * @param event the ActionEvent
&nbsp;     */
&nbsp;    @FXML
&nbsp;    public void filterQuestions(ActionEvent event) {
<b class="pc">&nbsp;        loadAllQuestions();</b>
<b class="pc">&nbsp;    }</b>
&nbsp;
&nbsp;    /**
&nbsp;     * Check if there is no filter applied for questions
&nbsp;     * @return true if there is no filter applied, false otherwise
&nbsp;     */
&nbsp;    public boolean noQuestionFilter() {
<b class="pc">&nbsp;        return (questionFilterTextField.getText().isEmpty() &amp;&amp;</b>
<b class="fc">&nbsp;                (typeFilterChoiceBox.getValue() == null || typeFilterChoiceBox.getValue().isEmpty()) &amp;&amp;</b>
<b class="fc">&nbsp;                scoreFilterTextField.getText().isEmpty());</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Check if there is no filter applied for exams
&nbsp;     * @return true if there is no filter applied, false otherwise
&nbsp;     */
&nbsp;    public boolean noExamFilter() {
<b class="pc">&nbsp;        return (examNameFilterTextField.getText().isEmpty() &amp;&amp;</b>
<b class="fc">&nbsp;                (courseIDFilterChoiceBox.getValue() == null || courseIDFilterChoiceBox.getValue().isEmpty()) &amp;&amp;</b>
<b class="fc">&nbsp;                (publishStatusFilterChoiceBox.getValue() == null || publishStatusFilterChoiceBox.getValue().isEmpty()));</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Load all questions from the database
&nbsp;     */
&nbsp;    public void loadAllQuestions() {
<b class="pc">&nbsp;        if (noQuestionFilter()) {</b>
&nbsp;            try {
<b class="fc">&nbsp;                allQuestions = questionDatabase.getAll();</b>
<b class="fc">&nbsp;                questionList = FXCollections.observableArrayList(allQuestions);</b>
<b class="fc">&nbsp;            } catch (Exception e) {</b>
<b class="fc">&nbsp;                MsgSender.showMsg(&quot;An error occurred while loading the questions.&quot;);</b>
<b class="fc">&nbsp;                e.printStackTrace();</b>
&nbsp;            }
&nbsp;        } else {
&nbsp;            try {
<b class="fc">&nbsp;                String questionFilter = questionFilterTextField.getText();</b>
<b class="fc">&nbsp;                String typeFilter = typeFilterChoiceBox.getValue();</b>
<b class="fc">&nbsp;                String scoreFilter = scoreFilterTextField.getText();</b>
&nbsp;
<b class="fc">&nbsp;                allQuestions = questionDatabase.getAll();</b>
<b class="fc">&nbsp;                List&lt;Question&gt; filteredQuestions = new ArrayList&lt;&gt;();</b>
&nbsp;
<b class="fc">&nbsp;                for (Question question : allQuestions) {</b>
<b class="pc">&nbsp;                    if ((questionFilter.isEmpty() || question.getQuestionDescription().contains(questionFilter)) &amp;&amp;</b>
<b class="pc">&nbsp;                            (typeFilter.isEmpty() || question.getQuestionType().equals(typeFilter)) &amp;&amp;</b>
<b class="pc">&nbsp;                            (scoreFilter.isEmpty() || question.getQuestionScore().equals(scoreFilter))) {</b>
<b class="fc">&nbsp;                        filteredQuestions.add(question);</b>
&nbsp;                    }
&nbsp;                }
&nbsp;
<b class="fc">&nbsp;                questionList = FXCollections.observableArrayList(filteredQuestions);</b>
<b class="nc">&nbsp;            } catch (Exception e) {</b>
<b class="nc">&nbsp;                MsgSender.showMsg(&quot;An error occurred while filtering the questions.&quot;);</b>
<b class="nc">&nbsp;                e.printStackTrace();</b>
&nbsp;            }
&nbsp;        }
&nbsp;
<b class="fc">&nbsp;        allQuestionsTable.getItems().setAll(questionList);</b>
<b class="fc">&nbsp;    }</b>
&nbsp;
&nbsp;    /**
&nbsp;     * Load exam questions from the exam question list
&nbsp;     */
&nbsp;    public void loadExamQuestions() {
<b class="pc">&nbsp;        examQuestionsTable.getItems().setAll(examQuestionList);</b>
<b class="pc">&nbsp;    }</b>
&nbsp;
&nbsp;    /**
&nbsp;     * Load exam questions from the database
&nbsp;     * @param id the id of the exam
&nbsp;     */
&nbsp;    public void loadExamQuestions(long id) {
&nbsp;        try {
<b class="pc">&nbsp;            Quiz quiz = quizDatabase.queryByKey(Long.toString(id));</b>
<b class="fc">&nbsp;            String questionIDsString = quiz.getQuestionIDs();</b>
&nbsp;
<b class="fc">&nbsp;            List&lt;String&gt; questionIDs = List.of(questionIDsString.split(&quot;\\|&quot;));</b>
<b class="fc">&nbsp;            List&lt;Question&gt; questions = new ArrayList&lt;&gt;();</b>
&nbsp;
<b class="fc">&nbsp;            for (String questionID : questionIDs) {</b>
<b class="fc">&nbsp;                questions.add(questionDatabase.queryByKey(questionID));</b>
&nbsp;            }
&nbsp;
<b class="fc">&nbsp;            examQuestionList.clear();</b>
<b class="fc">&nbsp;            examQuestionList = FXCollections.observableArrayList(questions);</b>
<b class="fc">&nbsp;            examQuestionsTable.getItems().setAll(examQuestionList);</b>
<b class="fc">&nbsp;        } catch (Exception e) {</b>
<b class="fc">&nbsp;            MsgSender.showMsg(&quot;An error occurred while loading the exam questions.&quot;);</b>
<b class="fc">&nbsp;            e.printStackTrace();</b>
&nbsp;        }
<b class="pc">&nbsp;    }</b>
&nbsp;
&nbsp;    /**
&nbsp;     * Load exams from the database
&nbsp;     */
&nbsp;    public void loadQuizzes() {
<b class="pc">&nbsp;        Platform.runLater(() -&gt; {</b>
<b class="fc">&nbsp;            if (noExamFilter()) {</b>
&nbsp;                try {
<b class="fc">&nbsp;                    allQuizzes = quizDatabase.getAll();</b>
<b class="fc">&nbsp;                    quizList = FXCollections.observableArrayList(allQuizzes);</b>
<b class="fc">&nbsp;                } catch (Exception e) {</b>
<b class="fc">&nbsp;                    MsgSender.showMsg(&quot;An error occurred while loading the exams.&quot;);</b>
<b class="nc">&nbsp;                    e.printStackTrace();</b>
&nbsp;                }
&nbsp;            } else {
&nbsp;                try {
<b class="fc">&nbsp;                    String examNameFilter = examNameFilterTextField.getText();</b>
<b class="fc">&nbsp;                    String courseIDFilter = courseIDFilterChoiceBox.getValue();</b>
<b class="fc">&nbsp;                    String publishFilter = publishStatusFilterChoiceBox.getValue();</b>
&nbsp;
<b class="fc">&nbsp;                    allQuizzes = quizDatabase.getAll();</b>
<b class="fc">&nbsp;                    List&lt;Quiz&gt; filteredQuizzes = new ArrayList&lt;&gt;();</b>
&nbsp;
<b class="fc">&nbsp;                    for (Quiz quiz : allQuizzes) {</b>
<b class="pc">&nbsp;                        if ((examNameFilter.isEmpty() || quiz.getQuizName().contains(examNameFilter)) &amp;&amp;</b>
<b class="pc">&nbsp;                                (courseIDFilter.isEmpty() || quiz.getCourseID().equals(courseIDFilter)) &amp;&amp;</b>
<b class="pc">&nbsp;                                (publishFilter.isEmpty() || quiz.getPublishStatus().equals(publishFilter))) {</b>
<b class="nc">&nbsp;                            filteredQuizzes.add(quiz);</b>
&nbsp;                        }
&nbsp;                    }
&nbsp;
<b class="fc">&nbsp;                    quizList = FXCollections.observableArrayList(filteredQuizzes);</b>
<b class="fc">&nbsp;                } catch (Exception e) {</b>
<b class="fc">&nbsp;                    MsgSender.showMsg(&quot;An error occurred while filtering the exams.&quot;);</b>
<b class="nc">&nbsp;                    e.printStackTrace();</b>
&nbsp;                }
&nbsp;            }
&nbsp;
<b class="fc">&nbsp;            examTable.getItems().setAll(quizList);</b>
&nbsp;        });
<b class="fc">&nbsp;    }</b>
&nbsp;
&nbsp;    /**
&nbsp;     * Clear all fields
&nbsp;     */
&nbsp;    public void clearFields() {
<b class="pc">&nbsp;        examNameInput.clear();</b>
<b class="fc">&nbsp;        examTimeInput.clear();</b>
<b class="fc">&nbsp;        courseIDInput.setValue(&quot;&quot;);</b>
<b class="fc">&nbsp;        publishInput.setValue(&quot;&quot;);</b>
<b class="fc">&nbsp;    }</b>
&nbsp;
&nbsp;}
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2024-11-18 19:43</div>
</div>
</body>
</html>
